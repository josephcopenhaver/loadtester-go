func (lt *Loadtest) writeOutputCsvRow_retry{{if .RetriesEnabled}}Enabled{{else}}Disabled{{end}}_maxTasks{{if .MaxTasksGTZero}}GTZero{{else}}NotGTZero{{end}}_percentile{{if .PercentileEnabled}}Enabled{{else}}Disabled{{end}}_variance{{if .VarianceEnabled}}Enabled{{else}}Disabled{{end}}() func(metricRecord_retry{{if .RetriesEnabled}}Enabled{{else}}Disabled{{end}}_maxTasks{{if not .MaxTasksGTZero}}Not{{end}}GTZero_percentile{{if .PercentileEnabled}}Enabled{{else}}Disabled{{end}}_variance{{if .VarianceEnabled}}Enabled{{else}}Disabled{{end}}) {
	{{if .PercentileEnabled}}
	var queuePercentiles, taskPercentiles [numPercentiles]latency
	{{end}}

	var bigAvgQueueLatency, bigAvgTaskLatency big.Int

	return func(mr metricRecord_retry{{if .RetriesEnabled}}Enabled{{else}}Disabled{{end}}_maxTasks{{if not .MaxTasksGTZero}}Not{{end}}GTZero_percentile{{if .PercentileEnabled}}Enabled{{else}}Disabled{{end}}_variance{{if .VarianceEnabled}}Enabled{{else}}Disabled{{end}}) {

		cd := &lt.csvData
		if cd.writeErr != nil {
			return
		}

		now := time.Now()

		{{if .MaxTasksGTZero}}
		var percent []byte
		{
			var buf [5]byte

			high := (mr.totalNumTasks / lt.maxTasks * percentDonePrecisionFactor) + ((mr.totalNumTasks % lt.maxTasks) * percentDonePrecisionFactor / lt.maxTasks)
			low := high % (percentDonePrecisionFactor / 100)
			high /= (percentDonePrecisionFactor / 100)

			percent = strconv.AppendInt(buf[:0], int64(high), 10)

			if low < 10 {
				percent = append(percent, ".0"...)
			} else {
				percent = append(percent, '.')
			}

			percent = strconv.AppendInt(percent, int64(low), 10)
		}
		{{end}}

		bigNumTasks := big.NewInt(int64(mr.numTasks))

		{{if .PercentileEnabled}}
		mr.latencies.queue.readPercentiles(&queuePercentiles)
		mr.latencies.task.readPercentiles(&taskPercentiles)
		{{end}}

		rw := cd.writer.MustNewRecord()
		defer rw.Rollback()

		rw.Int64(now.UnixNano())
		rw.Int64(mr.intervalID.UnixNano())
		rw.Int(mr.numIntervalTasks)
		rw.Duration(mr.lag)
		rw.Duration(mr.sumLag)
		rw.Int(mr.numTasks)
		rw.Int(mr.numPass)
		rw.Int(mr.numFail)
		{{if .RetriesEnabled}}rw.Int(mr.numRetry)
		{{end}}rw.Int(mr.numPanic)
		rw.Duration(mr.minQueueDuration)
		rw.Int64(bigAvgQueueLatency.Div(&mr.sumQueueDuration, bigNumTasks).Int64())
		rw.Duration(mr.maxQueueDuration)
		rw.Duration(mr.minTaskDuration)
		rw.Int64(bigAvgTaskLatency.Div(&mr.sumTaskDuration, bigNumTasks).Int64())
		rw.Duration(mr.maxTaskDuration){{if .PercentileEnabled}}
		csvFmtLatency(rw, queuePercentiles[0])
		csvFmtLatency(rw, queuePercentiles[1])
		csvFmtLatency(rw, queuePercentiles[2])
		csvFmtLatency(rw, queuePercentiles[3])
		csvFmtLatency(rw, queuePercentiles[4])
		csvFmtLatency(rw, queuePercentiles[5])
		csvFmtLatency(rw, queuePercentiles[6])
		csvFmtLatency(rw, queuePercentiles[7])
		csvFmtLatency(rw, queuePercentiles[8])
		csvFmtLatency(rw, queuePercentiles[9])
		csvFmtLatency(rw, taskPercentiles[0])
		csvFmtLatency(rw, taskPercentiles[1])
		csvFmtLatency(rw, taskPercentiles[2])
		csvFmtLatency(rw, taskPercentiles[3])
		csvFmtLatency(rw, taskPercentiles[4])
		csvFmtLatency(rw, taskPercentiles[5])
		csvFmtLatency(rw, taskPercentiles[6])
		csvFmtLatency(rw, taskPercentiles[7])
		csvFmtLatency(rw, taskPercentiles[8])
		csvFmtLatency(rw, taskPercentiles[9]){{end}}{{if .VarianceEnabled}}
		csvFmtLatencyVarianceAsInt64(rw, mr.welfords.queue.Variance(mr.numTasks))
		csvFmtLatencyVarianceAsInt64(rw, mr.welfords.task.Variance(mr.numTasks)){{end}}{{if .MaxTasksGTZero}}
		rw.UncheckedUTF8Bytes(percent){{end}}

		if _, err := rw.Write(); err != nil {
			cd.setErr(err) // sets error state in multiple goroutine safe way
		}
	}
}
